DECLARE @NOMBRES AS VARCHAR(MAX)
DECLARE @MAIL AS VARCHAR(MAX)
DECLARE @MAILASESOR AS VARCHAR(MAX)

DECLARE C_MAIL01 CURSOR

FOR 

SELECT T.nombres,T.mail,TV.mail
FROM Zeuss_Lin_Ventas ZL 
INNER JOIN terceros T ON (ZL.nit=T.nit)
INNER JOIN terceros TV ON (T.vendedor=TV.nit)
WHERE ZL.ano=2018 AND ZL.subgrupo2 IN (2,3,4) AND T.mail IS NOT NULL AND T.nit NOT IN (900004,900011,900018,
900026,900052,900053,900054,900055,900058,900060,900069,900083,900098,900101,900105,900113,900114,900115,
900135,900144,900155,900166,900170,900173,900175,900176,900178,900179,900194,900199,900206,900208,900216,
900218)
GROUP BY T.nit,T.nombres,T.mail,TV.mail

OPEN C_MAIL01


FETCH NEXT FROM C_MAIL01 INTO @NOMBRES,@MAIL,@MAILASESOR

 WHILE @@FETCH_STATUS = 0  
    BEGIN

		exec spEnviarHTML
		@SW=1,
		@RAZON_COMERCIAL =@NOMBRES,
		@MAIL=@MAIL,
		@CORREO_ASESOR=@MAILASESOR

		WAITFOR DELAY '00:00:15'

		FETCH NEXT FROM C_MAIL01 INTO @NOMBRES,@MAIL,@MAILASESOR
	END